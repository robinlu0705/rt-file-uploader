var rt_file_uploader=function(t){function e(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){t.exports=r(41)},function(t,e,r){var n=r(31)("wks"),a=r(33),i=r(4).Symbol,o="function"==typeof i,u=t.exports=function(t){return n[t]||(n[t]=o&&i[t]||(o?i:a)("Symbol."+t))};u.store=n},function(t,e){"use strict";function r(t,e,r,n){return function(o){for(var u=[],l=0;l<t.length&&l<e;l++)u.push({id:r+1+l,file:t.item(l)});if(o(a(u.map(function(t){return t.id}),r+u.length,e)),"function"==typeof n){var c=function(t){o(i(t.map(function(t){return{id:t.id,url:t.url,status:t.status,progress:t.progress,errMsg:t.errMsg,userDefinedData:t.userDefinedData}})))};n(u,c)}}}function n(t,e,r,n){return function(o){for(var u=[],l=0;l<t.length&&l<e;l++)u.push({id:r+1+l,url:t[l].url,userDefinedData:t[l].userDefinedData});if(o(a(u.map(function(t){return t.id}),r+u.length,e)),"function"==typeof n){var c=function(t){o(i(t.map(function(t){return{id:t.id,url:t.url,status:t.status,progress:t.progress,errMsg:t.errMsg,userDefinedData:t.userDefinedData}})))};n(u,c)}}}function a(t,e,r){return{type:h,payload:{IDList:t,runningID:e,limit:r}}}function i(t){return{type:D,payload:t}}function o(t,e,r){return t=t.slice(0,e).map(function(t,e){return{id:r+1+e,url:t.url,userDefinedData:t.userDefinedData}}),{type:L,payload:{list:t,limit:e,runningID:r+t.length}}}function u(t){return{type:O,payload:t}}function l(t){return{type:b,payload:t}}function c(t){var e=t.entityID,r=t.cursorX,n=t.cursorY;return{type:I,payload:{entityID:e,cursorX:r,cursorY:n}}}function s(t,e){return{type:P,payload:{editTarget:t,hoverTarget:e}}}function d(t){var e=t.entityID,r=t.cursorX,n=t.cursorY;return{type:A,payload:{entityID:e,cursorX:r,cursorY:n}}}function f(t){return{type:S,payload:t}}function p(){return{type:m}}function E(t){return{type:R,payload:t}}function g(t,e){return{type:G,payload:{category:t,page:e}}}function v(t,e,r){return function(n){if(n(y()),"function"==typeof r){var a=function(t){n(_(t.map(function(t){return{url:t.url,userDefinedData:t.userDefinedData}})))};r(t,Number(e),a)}}}function y(){return{type:x}}function _(t){return{type:F,payload:t}}function T(t){return{type:C,payload:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.uploadStart=r,e.uploadFromGalleryStart=n,e.addFile=o,e.deleteFile=u,e.updateLayout=l,e.startEdit=c,e.endEdit=s,e.updateEdit=d,e.updatePlaceholder=f,e.triggerGallery=p,e.setGalleryFilterOpts=E,e.changeGalleryFilter=g,e.fetchGalleryImage=v,e.changeGallerySelection=T;var h=(e.DISPLAY_MODE="DISPLAY_MODE",e.EDIT_MODE="EDIT_MODE",e.ADD_LOADING_FILE="ADD_LOADING_FILE"),D=e.UPDATE_LOADING_FILE="UPDATE_LOADING_FILE",L=e.ADD_FILE="ADD_FILE",O=e.DELETE_FILE="DELETE_FILE",I=e.START_EDIT="START_EDIT",A=e.UPDATE_EDIT="UPDATE_EDIT",P=e.END_EDIT="END_EDIT",S=e.UPDATE_PLACEHOLDER="UPDATE_PLACEHOLDER",b=e.UPDATE_LAYOUT="UPDATE_LAYOUT",m=e.TRIGGER_GALLERY="TRIGGER_GALLERY",R=e.SET_GALLERY_FILTER_OPTS="SET_GALLERY_FILTER_OPTS",G=e.CHANGE_GALLERY_FILTER="CHANGE_GALLERY_FILTER",x=e.REQUEST_GALLERY_IMAGE="REQUEST_GALLERY_IMAGE",F=e.RECEIVE_GALLERY_IMAGE="RECEIVE_GALLERY_IMAGE",C=e.CHANGE_GALLERY_SELECTION="CHANGE_GALLERY_SELECTION"},function(t,e){"use strict";function r(t){var e=arguments;return function(){for(var t=arguments,r=e.length;r-- >0;)t=[e[r].apply(this,t)];return t[0]}}function n(t,e){var r=Array.prototype.slice.call(arguments,1);return function(){var e=Array.prototype.slice.call(arguments,0);return t.apply(this,r.concat(e))}}Object.defineProperty(e,"__esModule",{value:!0}),e.compose=r,e.curryIt=n},function(t,e){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,e=arguments[1];switch(e.type){case y.ADD_LOADING_FILE:for(var r=e.payload.IDList,n=e.payload.runningID,a=e.payload.limit,i={},o=[],u=0,l=0;l<r.length&&u<a;l++){var c=r[l];i[c]={url:"",status:_,progress:0},o.push(c),++u}for(var s=0;s<t.order.length&&u<a;s++){var d=t.order[s];i[d]=t.entities[d],o.push(d),++u}return(0,g.default)({},t,{entities:i,order:o,selections:[],runningID:n});case y.UPDATE_LOADING_FILE:for(var f=e.payload,p=!1,E=f.map(function(t){return t.id}),v=0;v<t.order.length;v++){var D=t.order[v];if(E.indexOf(D)!==-1){p=!0;break}}if(p){for(var L=$.extend({},t.entities),O=t.order.slice(0),I=0;I<E.length;I++){var A=E[I],P=f[I].url,S=f[I].status,b=f[I].progress,m=f[I].errMsg,R=f[I].userDefinedData,G=L[A];G&&(G.url=P,G.status=S,G.progress=b,G.errMsg=m,G.userDefinedData=R)}return(0,g.default)({},t,{entities:L,order:O})}return t;case y.ADD_FILE:for(var x=e.payload.list,F=e.payload.runningID,C=e.payload.limit,M={},Y=[],w=0,U=0;U<x.length&&w<C;U++){var j=x[U].id,N=x[U].url,H=x[U].userDefinedData;M[j]={url:N,status:T,progress:100,errMsg:"",userDefinedData:H},Y.push(j),++w}for(var k=0;k<t.order.length&&w<C;k++){var X=t.order[k];M[X]=t.entities[X],Y.push(X),++w}return(0,g.default)({},t,{entities:M,order:Y,selections:[],runningID:F});case y.DELETE_FILE:var V=e.payload,W=t.order.indexOf(V);if(W===-1)return t;var Q=(0,g.default)({},t.entities),q=t.order.slice(0);return delete Q[V],q.splice(W,1),(0,g.default)({},t,{entities:Q,order:q,selections:[]});case y.END_EDIT:var B=e.payload.editTarget,z=e.payload.hoverTarget,J=t.order.indexOf(B),K=t.order.indexOf(z),Z=t.order.slice(0,J).concat(t.order.slice(J+1));return Z=Z.slice(0,K).concat([B]).concat(Z.slice(K)),$.extend({},t,{order:Z});default:return t}}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,e=arguments[1];switch(e.type){case y.UPDATE_LAYOUT:return(0,g.default)({},t,{thumbnailLayouts:e.payload});default:return t}}function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,e=arguments[1];switch(e.type){case y.START_EDIT:return(0,g.default)({},t,{mode:y.EDIT_MODE});case y.END_EDIT:return(0,g.default)({},t,{mode:y.DISPLAY_MODE});default:return t}}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,e=arguments[1];switch(e.type){case y.START_EDIT:return(0,g.default)({},t,{target:e.payload.entityID,startPos:{x:e.payload.cursorX,y:e.payload.cursorY},currentPos:{x:e.payload.cursorX,y:e.payload.cursorY}});case y.UPDATE_EDIT:return(0,g.default)({},t,{currentPos:{x:e.payload.cursorX,y:e.payload.cursorY}});default:return t}}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,e=arguments[1];switch(e.type){case y.START_EDIT:return(0,g.default)({},t,{hoverTarget:e.payload.entityID});case y.UPDATE_PLACEHOLDER:return(0,g.default)({},t,{hoverTarget:e.payload});case y.END_EDIT:return(0,g.default)({},t,{hoverTarget:null});default:return t}}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,e=arguments[1];switch(e.type){case y.TRIGGER_GALLERY:return(0,g.default)({},t,{isOpened:!t.isOpened});default:return t}}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,e=arguments[1];switch(e.type){case y.SET_GALLERY_FILTER_OPTS:var r=e.payload.filter(function(t){return t.hasOwnProperty("categoryVal")});return r.length>0?(0,g.default)({},t,{categoryList:r.map(function(t){return{text:t.categoryName||t.categoryVal,val:t.categoryVal,totalPages:t.totalPages}}),category:0,page:1}):t;case y.CHANGE_GALLERY_FILTER:var n=e.payload.category,a=e.payload.page;return(0,g.default)({},t,{page:a,category:n});case y.REQUEST_GALLERY_IMAGE:return(0,g.default)({},t,{isFetching:!0});case y.RECEIVE_GALLERY_IMAGE:return(0,g.default)({},t,{isFetching:!1});default:return t}}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,e=arguments[1];switch(e.type){case y.REQUEST_GALLERY_IMAGE:return(0,g.default)({},t,{isFetching:!0,list:[]});case y.RECEIVE_GALLERY_IMAGE:return(0,g.default)({},t,{isFetching:!1,list:e.payload});default:return t}}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,e=arguments[1];switch(e.type){case y.CHANGE_GALLERY_SELECTION:return(0,g.default)({},t,{list:e.payload});case y.REQUEST_GALLERY_IMAGE:return(0,g.default)({},t,{list:[]});default:return t}}Object.defineProperty(e,"__esModule",{value:!0}),e.GALLERY_SELECTION_DEPOT=e.GALLERY_IMAGE_DEPOT=e.GALLERY_FILTER_DEPOT=e.GALLERY_STATUS_DEPOT=e.PLACEHOLDER_DEPOT=e.EDIT_DEPOT=e.MODE_DEPOT=e.LAYOUT_DEPOT=e.FILE_DEPOT=e.FILE_STATUS_TIMEOUT=e.FILE_STATUS_ERROR=e.FILE_STATUS_COMPLETE=e.FILE_STATUS_LOADING=void 0;var E=r(43),g=a(E);e.fileDepot=i,e.layoutDepot=o,e.modeDepot=u,e.editDepot=l,e.placeholderDepot=c,e.galleryStatusDepot=s,e.galleryFilterDepot=d,e.galleryImageDepot=f,e.gallerySelectionDepot=p;var v=r(2),y=n(v),_=e.FILE_STATUS_LOADING="FILE_STATUS_LOADING",T=e.FILE_STATUS_COMPLETE="FILE_STATUS_COMPLETE",h=(e.FILE_STATUS_ERROR="FILE_STATUS_ERROR",e.FILE_STATUS_TIMEOUT="FILE_STATUS_TIMEOUT",e.FILE_DEPOT="FILE_DEPOT",e.LAYOUT_DEPOT="LAYOUT_DEPOT",e.MODE_DEPOT="MODE_DEPOT",e.EDIT_DEPOT="EDIT_DEPOT",e.PLACEHOLDER_DEPOT="PLACEHOLDER_DEPOT",e.GALLERY_STATUS_DEPOT="GALLERY_STATUS_DEPOT",e.GALLERY_FILTER_DEPOT="GALLERY_FILTER_DEPOT",e.GALLERY_IMAGE_DEPOT="GALLERY_IMAGE_DEPOT",e.GALLERY_SELECTION_DEPOT="GALLERY_SELECTION_DEPOT",{entities:{},order:[],selections:[],runningID:0}),D={thumbnailLayouts:[]},L={mode:y.DISPLAY_MODE},O={target:null,startPos:{x:0,y:0},currentPos:{x:0,y:0}},I={hoverTarget:null},A={isOpened:!1},P={page:1,categoryList:[{text:"--",val:"",totalPages:1}],category:0,isFetching:!1},S={list:[],isFetching:!1},b={list:[]}},function(t,e){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,e,r){var n=r(15),a=r(29);t.exports=r(10)?function(t,e,r){return n.f(t,e,a(1,r))}:function(t,e,r){return t[e]=r,t}},function(t,e){t.exports={}},function(t,e,r){var n=r(14);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t,e,r){t.exports=!r(13)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){var r={}.hasOwnProperty;t.exports=function(t,e){return r.call(t,e)}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,r){var n=r(9),a=r(53),i=r(68),o=Object.defineProperty;e.f=r(10)?Object.defineProperty:function(t,e,r){if(n(t),e=i(e,!0),n(r),a)try{return o(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t}},function(t,e,r){var n=r(31)("keys"),a=r(33);t.exports=function(t){return n[t]||(n[t]=a(t))}},function(t,e){var r=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?n:r)(t)}},function(t,e,r){var n=r(26),a=r(12);t.exports=function(t){return n(a(t))}},function(t,e){"use strict";function r(t,e){return t.append(e),t}function n(t,e){var r=t.left,n=t.top,a=t.width,i=t.height,o=e.x,u=e.y,l=r,c=r+a,s=n,d=n+i;return o>l&&o<c&&u>s&&u<d}Object.defineProperty(e,"__esModule",{value:!0}),e.appendNode=r,e.isCollided=n},function(t,e,r){t.exports={default:r(45),__esModule:!0}},function(t,e,r){var n=r(22),a=r(1)("toStringTag"),i="Arguments"==n(function(){return arguments}()),o=function(t,e){try{return t[e]}catch(t){}};t.exports=function(t){var e,r,u;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=o(e=Object(t),a))?r:i?n(e):"Object"==(u=n(e))&&"function"==typeof e.callee?"Arguments":u}},function(t,e){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,e,r){var n=r(14),a=r(4).document,i=n(a)&&n(a.createElement);t.exports=function(t){return i?a.createElement(t):{}}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,r){var n=r(4),a=r(6),i=r(51),o=r(7),u="prototype",l=function(t,e,r){var c,s,d,f=t&l.F,p=t&l.G,E=t&l.S,g=t&l.P,v=t&l.B,y=t&l.W,_=p?a:a[e]||(a[e]={}),T=_[u],h=p?n:E?n[e]:(n[e]||{})[u];p&&(r=e);for(c in r)s=!f&&h&&void 0!==h[c],s&&c in _||(d=s?h[c]:r[c],_[c]=p&&"function"!=typeof h[c]?r[c]:v&&s?i(d,n):y&&h[c]==d?function(t){var e=function(e,r,n){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,r)}return new t(e,r,n)}return t.apply(this,arguments)};return e[u]=t[u],e}(d):g&&"function"==typeof d?i(Function.call,d):d,g&&((_.virtual||(_.virtual={}))[c]=d,t&l.R&&T&&!T[c]&&o(T,c,d)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},function(t,e,r){var n=r(22);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},function(t,e,r){"use strict";var n=r(56),a=r(25),i=r(64),o=r(7),u=r(11),l=r(8),c=r(54),s=r(30),d=r(61),f=r(1)("iterator"),p=!([].keys&&"next"in[].keys()),E="@@iterator",g="keys",v="values",y=function(){return this};t.exports=function(t,e,r,_,T,h,D){c(r,e,_);var L,O,I,A=function(t){if(!p&&t in m)return m[t];switch(t){case g:return function(){return new r(this,t)};case v:return function(){return new r(this,t)}}return function(){return new r(this,t)}},P=e+" Iterator",S=T==v,b=!1,m=t.prototype,R=m[f]||m[E]||T&&m[T],G=R||A(T),x=T?S?A("entries"):G:void 0,F="Array"==e?m.entries||R:R;if(F&&(I=d(F.call(new t)),I!==Object.prototype&&(s(I,P,!0),n||u(I,f)||o(I,f,y))),S&&R&&R.name!==v&&(b=!0,G=function(){return R.call(this)}),n&&!D||!p&&!b&&m[f]||o(m,f,G),l[e]=G,l[P]=y,T)if(L={values:S?G:A(v),keys:h?G:A(g),entries:x},D)for(O in L)O in m||i(m,O,L[O]);else a(a.P+a.F*(p||b),e,L);return L}},function(t,e,r){var n=r(62),a=r(24);t.exports=Object.keys||function(t){return n(t,a)}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,r){var n=r(15).f,a=r(11),i=r(1)("toStringTag");t.exports=function(t,e,r){t&&!a(t=r?t:t.prototype,i)&&n(t,i,{configurable:!0,value:e})}},function(t,e,r){var n=r(4),a="__core-js_shared__",i=n[a]||(n[a]={});t.exports=function(t){return i[t]||(i[t]={})}},function(t,e,r){var n=r(12);t.exports=function(t){return Object(n(t))}},function(t,e){var r=0,n=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+n).toString(36))}},function(t,e,r){"use strict";var n=r(65)(!0);r(27)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,r=this._i;return r>=e.length?{value:void 0,done:!0}:(t=n(e,r),this._i+=t.length,{value:t,done:!1})})},function(t,e,r){r(72);for(var n=r(4),a=r(7),i=r(8),o=r(1)("toStringTag"),u=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],l=0;l<5;l++){var c=u[l],s=n[c],d=s&&s.prototype;d&&!d[o]&&a(d,o,c),i[c]=i.Array}},function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function a(t,e){var r=e.limit,n=$("<div />").addClass(d).css("minHeight",e.minHeight).on("dragover",function(t){t.preventDefault(),n.addClass("drag-over")}).on("dragleave",function(t){t.preventDefault(),n.removeClass("drag-over")}).on("drop",function(a){a.preventDefault(),n.removeClass("drag-over");var i=l.curryIt(t.getState.bind(t),s.FILE_DEPOT),u=a.originalEvent.dataTransfer.files;t.dispatch(o.uploadStart(u,r,i().runningID,e.onUpload))});return n}Object.defineProperty(e,"__esModule",{value:!0}),e.gen=a;var i=r(2),o=n(i),u=r(3),l=n(u),c=r(5),s=n(c),d="RT_FILE_UPLOADER"},function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function a(t,e,r){var n=d.curryIt(t.getState.bind(t),p.GALLERY_STATUS_DEPOT),a=d.curryIt(t.getState.bind(t),p.GALLERY_FILTER_DEPOT),i=d.curryIt(t.getState.bind(t),p.GALLERY_IMAGE_DEPOT),o=d.curryIt(t.getState.bind(t),p.GALLERY_SELECTION_DEPOT),u=d.curryIt(t.getState.bind(t),p.FILE_DEPOT);n().isOpened&&r.addClass("is-opened");var l=$("<div />").addClass("overlay").click(function(){t.dispatch(g.triggerGallery())}),c=$("<div />").addClass("title").text("露天圖庫"),s=function(){var r=$("<div />").addClass("content"),n=$("<div />").addClass("wrap"),l=function(){for(var r=$("<div />").addClass("tool-bar"),n=$("<select />").attr("data-ref","galleryPagination"),i=1;i<=a().categoryList[a().category].totalPages;i++){var o=$("<option />").attr("value",i).text("第 "+i.toString()+" 頁");n.append(o)}n.val(a().page).change(function(r){var n=$(r.currentTarget);t.dispatch(g.changeGalleryFilter(a().category,Number(n.val()))),t.dispatch(g.fetchGalleryImage(a().categoryList[a().category].val,Number(n.val()),e.onFetchGallery))});for(var u=$("<select />").attr("data-ref","galleryCategory"),l=0;l<a().categoryList.length;l++){var c=a().categoryList[l],s=$("<option />").attr("value",c.val).text(c.text);u.append(s)}return u.val(a().category).change(function(r){var n=$(r.currentTarget);t.dispatch(g.changeGalleryFilter(Number(n.val()),1)),t.dispatch(g.fetchGalleryImage(a().categoryList[a().category].val,1,e.onFetchGallery))}),r.append(u).append(n)}(),c=function(){for(var t=$("<div />").addClass("list-view").attr("data-ref","galleryListView"),r=0;r<i().list.length;r++){var n=i().list[r].url,a=$("<div />").addClass("list-item"),o=$("<img />").attr("width",e.thumbnailWidth).attr("height",e.thumbnailHeight).attr("src",n);a.append(o),t.append(a)}return t}(),s=function(){var r=$("<div />").addClass("btn-bar"),n=$("<button />").attr("type","button").addClass("rt-button rt-button-mini rt-button-submit").text("確定新增").click(function(r){var n=[],a=u().runningID,l=o().list,c=i().list;if(l.length){for(var s=0;s<l.length;s++){var d=l[s];n.push({url:c[d].url,userDefinedData:c[d].userDefinedData})}t.dispatch(g.uploadFromGalleryStart(n,e.limit,a,e.onUploadFromGallery)),t.dispatch(g.triggerGallery())}}),a=$("<a />").attr("href","#").text("取消").click(function(e){e.preventDefault(),t.dispatch(g.triggerGallery())});return r.append(n).append(a)}();return n.append(l).append(c).append(s),r.append(n)}(),f=$("<div />").addClass("dialog").append(c).append(s);return r.append(l).append(f),r}function i(t,e,r){var n=d.curryIt(t.getState.bind(t),p.GALLERY_STATUS_DEPOT);n().isOpened?r.addClass("is-opened"):r.removeClass("is-opened")}function o(t,e,r){var n=d.curryIt(t.getState.bind(t),p.GALLERY_FILTER_DEPOT),a=r.find("[data-ref=galleryPagination]"),i=r.find("[data-ref=galleryCategory]");a.empty();for(var o=1;o<=n().categoryList[n().category].totalPages;o++){var u=$("<option />").attr("value",o).text("第 "+o.toString()+" 頁");a.append(u)}a.val(n().page),i.empty();for(var l=0;l<n().categoryList.length;l++){var c=n().categoryList[l],s=$("<option />").attr("value",l.toString()).text(c.text);i.append(s)}i.val(n().category),n().isFetching?(a.prop("disabled",!0),i.prop("disabled",!0)):(a.prop("disabled",!1),i.prop("disabled",!1))}function u(t,e,r){var n=d.curryIt(t.getState.bind(t),p.GALLERY_IMAGE_DEPOT),a=d.curryIt(t.getState.bind(t),p.GALLERY_SELECTION_DEPOT),i=r.find("[data-ref=galleryListView]");if(i.empty(),n().isFetching){var o=$("<i />").addClass("fa fa-circle-o-notch fa-spin fa-2x fa-fw loading-ring");i.append(o)}else for(var u=0;u<n().list.length;u++){var l=n().list[u].url,c=$("<div />").addClass("list-item").click(function(r){var n=$(r.currentTarget),i=a().list.slice(0),o=n.index(),u=i.indexOf(o);u===-1?(i.push(o),i.length>e.limit&&(i=i.slice(i.length-e.limit))):i.splice(u,1),t.dispatch(g.changeGallerySelection(i))}),s=$("<img />").attr("width",e.thumbnailWidth).attr("height",e.thumbnailHeight).attr("src",l);c.append(s),i.append(c)}}function l(t,e,r){var n=d.curryIt(t.getState.bind(t),p.GALLERY_SELECTION_DEPOT),a=r.find("[data-ref=galleryListView]");a.find(".is-selected").removeClass("is-selected");for(var i=0;i<n().list.length;i++){var o=n().list[i];a.children().eq(o).addClass("is-selected")}}function c(t,e){var r=$("<div />").addClass("gallery");return t.listen(p.GALLERY_STATUS_DEPOT,function(){i(t,e,r)}),t.listen(p.GALLERY_FILTER_DEPOT,function(){o(t,e,r)}),t.listen(p.GALLERY_IMAGE_DEPOT,function(){u(t,e,r)}),t.listen(p.GALLERY_SELECTION_DEPOT,function(){l(t,e,r)}),a(t,e,r)}Object.defineProperty(e,"__esModule",{value:!0}),e.gen=c;var s=r(3),d=n(s),f=r(5),p=n(f),E=r(2),g=n(E)},function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function a(t,e,r){return t(e,r)}function i(t,e){var r=[];for(var n in e)e[n]!==t[n]&&r.push(n);return r}function o(t,e){return e?t.state[e]:t.state}function u(t,e,r){for(var n=e.toString()||"",a=0;a<r.length;a++)t.trigger(n+r[a])}function l(t,e,r,n){var a=e.toString()||"";t.on(a+r,n)}function c(t,e){var r=$("<div />"),n=d.curryIt(a,t),c=d.curryIt(u,r,f),s=d.curryIt(o,r),p=d.curryIt(l,r,f);return r.state=t({},{}),r.state.__DEBUG__={action:{},diff:[]},r.getState=s,r.listen=p,r.dispatch=function(t){if("function"==typeof t)t(r.dispatch);else{var a=n(r.state,t),o=i(r.state,a);if(e){for(var u={},l=0;l<o.length;l++)u[o[l]]=a[o[l]];console.log("\n===Action fired==="),console.log("-> Action:"),console.log(t),console.log("-> Changed parts: "),console.log(u),console.log("===================\n")}o.length&&(r.state=a,c(o))}},r}Object.defineProperty(e,"__esModule",{value:!0}),e.createStore=c;var s=r(3),d=n(s),f="RT_FILE_UPLOADER"},function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}function i(t,e,r){var n=e.thumbnailWidth,a=e.thumbnailHeight,i=g.curryIt(t.getState.bind(t),D.FILE_DEPOT),o=g.curryIt(t.getState.bind(t),D.MODE_DEPOT);r.empty();var u=i().order.map(function(e,u){var l=i().entities[e],c=$("<div />").attr("data-ref","thumbnail").addClass("thumbnail").attr("data-key",u).css("width",n).css("height",a).on("touchstart mousedown",function(n){n.preventDefault();var a=$(n.currentTarget);if(o().mode===T.DISPLAY_MODE){var i=r.offset(),u=(a.offset(),n.originalEvent.targetTouches),l=u?u[0].pageX:n.pageX,c=u?u[0].pageY:n.pageY;t.dispatch(T.startEdit({entityID:e,cursorX:l-i.left,cursorY:c-i.top}))}}),s=$("<div />").addClass("img");switch(l.status){case D.FILE_STATUS_LOADING:var d=$("<i />").addClass("fa fa-circle-o-notch fa-spin fa-2x fa-fw loading-ring");s.append(d);break;case D.FILE_STATUS_COMPLETE:s.css("background-image","url("+l.url+")");break;case D.FILE_STATUS_ERROR:var f=$("<div />").addClass("msg").append($("<i />").addClass("fa fa-exclamation-triangle icon")).append($("<div />").addClass("text").text(l.errMsg));s.append(f)}var p=$("<div />").addClass("img-wrap").css("width",n).css("height",a).append(s),E=$("<i />").addClass("fa").addClass("fa-times").addClass("delete").on("touchstart mousedown",function(t){t.stopPropagation()}).click(function(r){r.stopPropagation(),t.dispatch(T.deleteFile(e))});return c.append(p).append(E),c}),l=!0,c=!1,s=void 0;try{for(var d,f=(0,p.default)(u);!(l=(d=f.next()).done);l=!0){var E=d.value;r.append(E)}}catch(t){c=!0,s=t}finally{try{!l&&f.return&&f.return()}finally{if(c)throw s}}var v=u.map(function(t){return t.position()});return t.dispatch(T.updateLayout(v)),r}function o(t,e,r){var n=e.thumbnailWidth,a=e.thumbnailHeight,i=g.curryIt(t.getState.bind(t),D.MODE_DEPOT),o=g.curryIt(t.getState.bind(t),D.LAYOUT_DEPOT),u=g.curryIt(t.getState.bind(t),D.EDIT_DEPOT),l=g.curryIt(t.getState.bind(t),D.FILE_DEPOT),c=g.curryIt(t.getState.bind(t),D.PLACEHOLDER_DEPOT);i().mode===T.EDIT_MODE?r.on("touchend mouseup",function(e){i().mode===T.EDIT_MODE&&t.dispatch(T.endEdit(u().target,c().hoverTarget))}).on("touchmove mousemove",function(e){e.preventDefault();var r=$(e.currentTarget),i=r.offset(),c=e.originalEvent.targetTouches,s=c?c[0].pageX:e.pageX,f=c?c[0].pageY:e.pageY,E=s-i.left,g=f-i.top;t.dispatch(T.updateEdit({entityID:u().target,cursorX:E,cursorY:g}));var v=!0,_=!1,h=void 0;try{for(var D,L=(0,p.default)(o().thumbnailLayouts.entries());!(v=(D=L.next()).done);v=!0){var O=(0,d.default)(D.value,2),I=O[0],A=O[1],P={left:A.left,top:A.top,width:n,height:a},S={x:E,y:g};if(y.isCollided(P,S))return t.dispatch(T.updatePlaceholder(l().order[I])),!1}}catch(t){_=!0,h=t}finally{try{!v&&L.return&&L.return()}finally{if(_)throw h}}}):r.off("touchmove").off("mousemove").off("touchend").off("mouseup")}function u(t,e,r){var n=g.curryIt(t.getState.bind(t),D.MODE_DEPOT),a=g.curryIt(t.getState.bind(t),D.EDIT_DEPOT),i=g.curryIt(t.getState.bind(t),D.FILE_DEPOT),o=g.curryIt(t.getState.bind(t),D.LAYOUT_DEPOT);if(n().mode===T.EDIT_MODE){var u=!0,l=!1,c=void 0;try{for(var s,f=(0,p.default)(i().order.entries());!(u=(s=f.next()).done);u=!0){var E=(0,d.default)(s.value,2),v=E[0],y=E[1];y===a().target&&r.children("[data-ref=thumbnail]").eq(v).attr("date-ref","dragTarget").addClass("drag-target").css({position:"absolute",zIndex:"99",left:o().thumbnailLayouts[v].left+a().currentPos.x-a().startPos.x,top:o().thumbnailLayouts[v].top+a().currentPos.y-a().startPos.y-7})}}catch(t){l=!0,c=t}finally{try{!u&&f.return&&f.return()}finally{if(l)throw c}}}return r}function l(t,e,r){var n=e.thumbnailWidth,a=e.thumbnailHeight,i=g.curryIt(t.getState.bind(t),D.FILE_DEPOT),o=g.curryIt(t.getState.bind(t),D.EDIT_DEPOT),u=g.curryIt(t.getState.bind(t),D.PLACEHOLDER_DEPOT),l=u().hoverTarget,c=o().target;if(r.children("[data-ref=placeholder]").remove(),null!==l){var s=i().order.indexOf(l),d=i().order.indexOf(c),f=r.children("[data-ref=thumbnail]").eq(s),p=$("<div />").attr("data-ref","placeholder").addClass("placeholder").css({width:n,height:a});d>s?p.insertBefore(f):p.insertAfter(f)}return r}function c(t,e){var r=(g.curryIt(t.getState.bind(t),D.MODE_DEPOT),g.curryIt(t.getState.bind(t),D.EDIT_DEPOT),g.curryIt(t.getState.bind(t),D.PLACEHOLDER_DEPOT),$("<div />").addClass("thumbnail-viewer"));return t.listen(D.FILE_DEPOT,function(){i(t,e,r)}),t.listen(D.MODE_DEPOT,function(){o(t,e,r)}),t.listen(D.EDIT_DEPOT,function(){u(t,e,r)}),t.listen(D.PLACEHOLDER_DEPOT,function(){l(t,e,r)}),i(t,e,r)}Object.defineProperty(e,"__esModule",{value:!0});var s=r(44),d=a(s),f=r(20),p=a(f);e.gen=c;var E=r(3),g=n(E),v=r(19),y=n(v),_=r(2),T=n(_),h=r(5),D=n(h)},function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function a(t,e,r){var n=(e.limit,u.curryIt(t.getState.bind(t),d.FILE_DEPOT));return n().order.length?r.removeClass("hint").css("height","auto"):r.addClass("hint"),r}function i(t,e){var r=u.curryIt(t.getState.bind(t),d.GALLERY_FILTER_DEPOT),n=e.limit,i=$("<div />").addClass("hint-text").append($("<span />").text("選擇檔案")),o=$("<div />").addClass("hint-text").append($("<span />").addClass("separator").text("或")).append($("<span />").text("拖曳檔案至此")),l=$("<i />").addClass("upload-icon").addClass("fa").addClass("fa-upload"),s=$('<input type="file" accept="image/*;capture=camera"/>').addClass("add-local-input").attr("multiple","").change(function(r){var a=u.curryIt(t.getState.bind(t),d.FILE_DEPOT),i=$(r.currentTarget),o=i[0].files;t.dispatch(c.uploadStart(o,n,a().runningID,e.onUpload)),i.val("")}),f=$("<div />").addClass("rt-button").addClass("rt-button-mini").addClass("rt-button-default").text("本地檔案"),p=$("<label />").addClass("action").append(s).append(f),E=$("<button />").attr("type","button").addClass("action").addClass("rt-button").addClass("rt-button-mini").addClass("rt-button-default").text("露天圖庫").click(function(n){t.dispatch(c.triggerGallery()),t.dispatch(c.fetchGalleryImage(r().categoryList[r().category].val,r().page,e.onFetchGallery))}),g=$("<div />").addClass("wrap").append(l).append(i).append(p).append(E).append(o),v=$("<div />").addClass("tool-bar").append(g);return t.listen(d.FILE_DEPOT,function(){a(t,e,v)}),a(t,e,v)}Object.defineProperty(e,"__esModule",{value:!0}),e.gen=i;var o=r(3),u=n(o),l=r(2),c=n(l),s=r(5),d=n(s)},function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function a(t){return $.extend({},t,{minHeight:t.minHeight||160,thumbnailWidth:t.thumbnailWidth||120,thumbnailHeight:t.thumbnailHeight||90,limit:t.limit||3,galleryFilterOpts:t.galleryFilterOpts instanceof Array?t.galleryFilterOpts:[]})}function i(t){var e=function(t,e){var r={};return r[E.FILE_DEPOT]=E.fileDepot(t[E.FILE_DEPOT],e),r[E.LAYOUT_DEPOT]=E.layoutDepot(t[E.LAYOUT_DEPOT],e),r[E.MODE_DEPOT]=E.modeDepot(t[E.MODE_DEPOT],e),r[E.EDIT_DEPOT]=E.editDepot(t[E.EDIT_DEPOT],e),r[E.PLACEHOLDER_DEPOT]=E.placeholderDepot(t[E.PLACEHOLDER_DEPOT],e),r[E.GALLERY_STATUS_DEPOT]=E.galleryStatusDepot(t[E.GALLERY_STATUS_DEPOT],e),r[E.GALLERY_FILTER_DEPOT]=E.galleryFilterDepot(t[E.GALLERY_FILTER_DEPOT],e),r[E.GALLERY_IMAGE_DEPOT]=E.galleryImageDepot(t[E.GALLERY_IMAGE_DEPOT],e),r[E.GALLERY_SELECTION_DEPOT]=E.gallerySelectionDepot(t[E.GALLERY_SELECTION_DEPOT],e),r};return s.createStore(e,t.debug)}function o(t,e){var r=_.gen(t,e),n=h.gen(t,e),a=L.gen(t,e),i=I.gen(t,e),o=l.curryIt(f.appendNode,r);return o(n),o(a),o(i),r}var u=r(3),l=n(u),c=r(38),s=n(c),d=r(19),f=n(d),p=r(5),E=n(p),g=r(2),v=n(g),y=r(36),_=n(y),T=r(40),h=n(T),D=r(39),L=n(D),O=r(37),I=n(O);window.RT=window.RT||{};var A=RT.FileUploader={};A.gen=function(t,e){e=a(e);var r=l.curryIt(f.appendNode,t),n=i(e);n.dispatch(v.setGalleryFilterOpts(e.galleryFilterOpts));var u=o(n,e);return r(u),{getFiles:function(){var t=l.curryIt(n.getState.bind(n),E.FILE_DEPOT);return t().order.map(function(e){var r=t().entities[e];return{id:e,url:r.url,status:r.status,progress:r.progress,errMsg:r.errMsg,userDefinedData:r.userDefinedData}})},setFiles:function(t){var r=l.curryIt(n.getState.bind(n),E.FILE_DEPOT);n.dispatch(v.addFile(t.map(function(t){return{url:t.url,userDefinedData:t.userDefinedData}}),e.limit,r().runningID))}}},A.FILE_STATUS={COMPLETE:E.FILE_STATUS_COMPLETE,LOADING:E.FILE_STATUS_LOADING,ERROR:E.FILE_STATUS_ERROR,TIMEOUT:E.FILE_STATUS_TIMEOUT}},function(t,e,r){t.exports={default:r(46),__esModule:!0}},function(t,e,r){t.exports={default:r(47),__esModule:!0}},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var a=r(42),i=n(a),o=r(20),u=n(o);e.default=function(){function t(t,e){var r=[],n=!0,a=!1,i=void 0;try{for(var o,l=(0,u.default)(t);!(n=(o=l.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){a=!0,i=t}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}return r}return function(e,r){if(Array.isArray(e))return e;if((0,i.default)(Object(e)))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},function(t,e,r){r(35),r(34),t.exports=r(70)},function(t,e,r){r(35),r(34),t.exports=r(71)},function(t,e,r){r(73),t.exports=r(6).Object.assign},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e){t.exports=function(){}},function(t,e,r){var n=r(18),a=r(67),i=r(66);t.exports=function(t){return function(e,r,o){var u,l=n(e),c=a(l.length),s=i(o,c);if(t&&r!=r){for(;c>s;)if(u=l[s++],u!=u)return!0}else for(;c>s;s++)if((t||s in l)&&l[s]===r)return t||s||0;return!t&&-1}}},function(t,e,r){var n=r(48);t.exports=function(t,e,r){if(n(t),void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,a){return t.call(e,r,n,a)}}return function(){return t.apply(e,arguments)}}},function(t,e,r){t.exports=r(4).document&&document.documentElement},function(t,e,r){t.exports=!r(10)&&!r(13)(function(){return 7!=Object.defineProperty(r(23)("div"),"a",{
get:function(){return 7}}).a})},function(t,e,r){"use strict";var n=r(58),a=r(29),i=r(30),o={};r(7)(o,r(1)("iterator"),function(){return this}),t.exports=function(t,e,r){t.prototype=n(o,{next:a(1,r)}),i(t,e+" Iterator")}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e){t.exports=!0},function(t,e,r){"use strict";var n=r(28),a=r(60),i=r(63),o=r(32),u=r(26),l=Object.assign;t.exports=!l||r(13)(function(){var t={},e={},r=Symbol(),n="abcdefghijklmnopqrst";return t[r]=7,n.split("").forEach(function(t){e[t]=t}),7!=l({},t)[r]||Object.keys(l({},e)).join("")!=n})?function(t,e){for(var r=o(t),l=arguments.length,c=1,s=a.f,d=i.f;l>c;)for(var f,p=u(arguments[c++]),E=s?n(p).concat(s(p)):n(p),g=E.length,v=0;g>v;)d.call(p,f=E[v++])&&(r[f]=p[f]);return r}:l},function(t,e,r){var n=r(9),a=r(59),i=r(24),o=r(16)("IE_PROTO"),u=function(){},l="prototype",c=function(){var t,e=r(23)("iframe"),n=i.length,a="<",o=">";for(e.style.display="none",r(52).appendChild(e),e.src="javascript:",t=e.contentWindow.document,t.open(),t.write(a+"script"+o+"document.F=Object"+a+"/script"+o),t.close(),c=t.F;n--;)delete c[l][i[n]];return c()};t.exports=Object.create||function(t,e){var r;return null!==t?(u[l]=n(t),r=new u,u[l]=null,r[o]=t):r=c(),void 0===e?r:a(r,e)}},function(t,e,r){var n=r(15),a=r(9),i=r(28);t.exports=r(10)?Object.defineProperties:function(t,e){a(t);for(var r,o=i(e),u=o.length,l=0;u>l;)n.f(t,r=o[l++],e[r]);return t}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,r){var n=r(11),a=r(32),i=r(16)("IE_PROTO"),o=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=a(t),n(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?o:null}},function(t,e,r){var n=r(11),a=r(18),i=r(50)(!1),o=r(16)("IE_PROTO");t.exports=function(t,e){var r,u=a(t),l=0,c=[];for(r in u)r!=o&&n(u,r)&&c.push(r);for(;e.length>l;)n(u,r=e[l++])&&(~i(c,r)||c.push(r));return c}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,r){t.exports=r(7)},function(t,e,r){var n=r(17),a=r(12);t.exports=function(t){return function(e,r){var i,o,u=String(a(e)),l=n(r),c=u.length;return l<0||l>=c?t?"":void 0:(i=u.charCodeAt(l),i<55296||i>56319||l+1===c||(o=u.charCodeAt(l+1))<56320||o>57343?t?u.charAt(l):i:t?u.slice(l,l+2):(i-55296<<10)+(o-56320)+65536)}}},function(t,e,r){var n=r(17),a=Math.max,i=Math.min;t.exports=function(t,e){return t=n(t),t<0?a(t+e,0):i(t,e)}},function(t,e,r){var n=r(17),a=Math.min;t.exports=function(t){return t>0?a(n(t),9007199254740991):0}},function(t,e,r){var n=r(14);t.exports=function(t,e){if(!n(t))return t;var r,a;if(e&&"function"==typeof(r=t.toString)&&!n(a=r.call(t)))return a;if("function"==typeof(r=t.valueOf)&&!n(a=r.call(t)))return a;if(!e&&"function"==typeof(r=t.toString)&&!n(a=r.call(t)))return a;throw TypeError("Can't convert object to primitive value")}},function(t,e,r){var n=r(21),a=r(1)("iterator"),i=r(8);t.exports=r(6).getIteratorMethod=function(t){if(void 0!=t)return t[a]||t["@@iterator"]||i[n(t)]}},function(t,e,r){var n=r(9),a=r(69);t.exports=r(6).getIterator=function(t){var e=a(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},function(t,e,r){var n=r(21),a=r(1)("iterator"),i=r(8);t.exports=r(6).isIterable=function(t){var e=Object(t);return void 0!==e[a]||"@@iterator"in e||i.hasOwnProperty(n(e))}},function(t,e,r){"use strict";var n=r(49),a=r(55),i=r(8),o=r(18);t.exports=r(27)(Array,"Array",function(t,e){this._t=o(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,a(1)):"keys"==e?a(0,r):"values"==e?a(0,t[r]):a(0,[r,t[r]])},"values"),i.Arguments=i.Array,n("keys"),n("values"),n("entries")},function(t,e,r){var n=r(25);n(n.S+n.F,"Object",{assign:r(57)})}]);