var rt_file_uploader=function(t){function e(a){if(r[a])return r[a].exports;var n=r[a]={exports:{},id:a,loaded:!1};return t[a].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){t.exports=r(10)},function(t,e){"use strict";function r(t,e,r,a){return function(n){for(var i=[],o=0;o<t.length&&o<e;o++)i.push({id:r+1+o,file:t.item(o)});if(n(b($.map(i,function(t){return t.id}),r+i.length,e)),"function"==typeof a){var l=function(t){n(C($.map(t,function(t){return{id:t.id,url:t.url,status:t.status,progress:t.progress,errMsg:t.errMsg,userDefinedData:t.userDefinedData}})))};a(i,l)}}}function a(t,e,r,a){return function(n){for(var i=[],o=0;o<t.length&&o<e;o++)i.push({id:r+1+o,url:t[o].url,userDefinedData:t[o].userDefinedData});if(n(b($.map(i,function(t){return t.id}),r+i.length,e)),"function"==typeof a){var l=function(t){n(C($.map(t,function(t){return{id:t.id,url:t.url,status:t.status,progress:t.progress,errMsg:t.errMsg,userDefinedData:t.userDefinedData}})))};a(i,l)}}}function n(t,e,r){return t=$.map(t.slice(0,e),function(t,e){return{id:r+1+e,url:t.url,userDefinedData:t.userDefinedData}}),{type:T,payload:{list:t,limit:e,runningID:r+t.length}}}function i(t){return{type:L,payload:t}}function o(t){return{type:h,payload:t}}function l(t){var e=t.entityID,r=t.cursorX,a=t.cursorY;return{type:y,payload:{entityID:e,cursorX:r,cursorY:a}}}function u(t,e){return{type:O,payload:{editTarget:t,hoverTarget:e}}}function d(t){var e=t.entityID,r=t.cursorX,a=t.cursorY;return{type:I,payload:{entityID:e,cursorX:r,cursorY:a}}}function s(t){return{type:v,payload:t}}function c(){return{type:A}}function E(t){return{type:P,payload:t}}function p(t,e){return{type:S,payload:{category:t,page:e}}}function f(t,e,r){return function(a){if(a(F()),"function"==typeof r){var n=function(t){a(Y($.map(t,function(t){return{url:t.url,userDefinedData:t.userDefinedData}})))};r(t,Number(e),n)}}}function g(t){return{type:m,payload:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.uploadStart=r,e.uploadFromGalleryStart=a,e.addFile=n,e.deleteFile=i,e.updateLayout=o,e.startEdit=l,e.endEdit=u,e.updateEdit=d,e.updatePlaceholder=s,e.triggerGallery=c,e.setGalleryFilterOpts=E,e.changeGalleryFilter=p,e.fetchGalleryImage=f,e.changeGallerySelection=g;var _=(e.DISPLAY_MODE="DISPLAY_MODE",e.EDIT_MODE="EDIT_MODE",e.ADD_LOADING_FILE="ADD_LOADING_FILE"),D=e.UPDATE_LOADING_FILE="UPDATE_LOADING_FILE",T=e.ADD_FILE="ADD_FILE",L=e.DELETE_FILE="DELETE_FILE",y=e.START_EDIT="START_EDIT",I=e.UPDATE_EDIT="UPDATE_EDIT",O=e.END_EDIT="END_EDIT",v=e.UPDATE_PLACEHOLDER="UPDATE_PLACEHOLDER",h=e.UPDATE_LAYOUT="UPDATE_LAYOUT",A=e.TRIGGER_GALLERY="TRIGGER_GALLERY",P=e.SET_GALLERY_FILTER_OPTS="SET_GALLERY_FILTER_OPTS",S=e.CHANGE_GALLERY_FILTER="CHANGE_GALLERY_FILTER",R=e.REQUEST_GALLERY_IMAGE="REQUEST_GALLERY_IMAGE",G=e.RECEIVE_GALLERY_IMAGE="RECEIVE_GALLERY_IMAGE",m=e.CHANGE_GALLERY_SELECTION="CHANGE_GALLERY_SELECTION",b=function(t,e,r){return{type:_,payload:{IDList:t,runningID:e,limit:r}}},C=function(t){return{type:D,payload:t}},F=function(){return{type:R}},Y=function(t){return{type:G,payload:t}}},function(t,e){"use strict";function r(t){var e=arguments;return function(){for(var t=arguments,r=e.length;r-- >0;)t=[e[r].apply(this,t)];return t[0]}}function a(t,e){var r=Array.prototype.slice.call(arguments,1);return function(){var e=Array.prototype.slice.call(arguments,0);return t.apply(this,r.concat(e))}}Object.defineProperty(e,"__esModule",{value:!0}),e.compose=r,e.curryIt=a},function(t,e,r){"use strict";function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function n(t,e){switch(t=t||D,e.type){case f.ADD_LOADING_FILE:for(var r=e.payload.IDList,a=e.payload.runningID,n=e.payload.limit,i={},o=[],l=0,u=0;u<r.length&&l<n;u++){var d=r[u];i[d]={url:"",status:g,progress:0},o.push(d),++l}for(var u=0;u<t.order.length&&l<n;u++){var d=t.order[u];i[d]=t.entities[d],o.push(d),++l}return $.extend({},t,{entities:i,order:o,selections:[],runningID:a});case f.UPDATE_LOADING_FILE:for(var s=e.payload,c=!1,r=$.map(s,function(t){return t.id}),u=0;u<t.order.length;u++){var d=t.order[u];if(r.indexOf(d)!==-1){c=!0;break}}if(c){for(var i=$.extend({},t.entities),o=t.order.slice(0),u=0;u<r.length;u++){var d=r[u],E=s[u].url,p=s[u].status,T=s[u].progress,L=s[u].errMsg,y=s[u].userDefinedData,I=i[d];I&&(I.url=E,I.status=p,I.progress=T,I.errMsg=L,I.userDefinedData=y)}return $.extend({},t,{entities:i,order:o})}return t;case f.ADD_FILE:for(var s=e.payload.list,a=e.payload.runningID,n=e.payload.limit,i={},o=[],l=0,u=0;u<s.length&&l<n;u++){var d=s[u].id,E=s[u].url,y=s[u].userDefinedData;i[d]={url:E,status:_,progress:100,errMsg:"",userDefinedData:y},o.push(d),++l}for(var u=0;u<t.order.length&&l<n;u++){var d=t.order[u];i[d]=t.entities[d],o.push(d),++l}return $.extend({},t,{entities:i,order:o,selections:[],runningID:a});case f.DELETE_FILE:var d=e.payload,O=t.order.indexOf(d);if(O===-1)return t;var i=$.extend({},t.entities),o=t.order.slice(0);return delete i[d],o.splice(O,1),$.extend({},t,{entities:i,order:o,selections:[]});case f.END_EDIT:var v=e.payload.editTarget,h=e.payload.hoverTarget,A=t.order.indexOf(v),P=t.order.indexOf(h),S=t.order.slice(0,A).concat(t.order.slice(A+1));return S=S.slice(0,P).concat([v]).concat(S.slice(P)),$.extend({},t,{order:S});default:return t}}function i(t,e){switch(t=t||T,e.type){case f.UPDATE_LAYOUT:return $.extend({},t,{thumbnailLayouts:e.payload});default:return t}}function o(t,e){switch(t=t||L,e.type){case f.START_EDIT:return $.extend({},t,{mode:f.EDIT_MODE});case f.END_EDIT:return $.extend({},t,{mode:f.DISPLAY_MODE});default:return t}}function l(t,e){switch(t=t||y,e.type){case f.START_EDIT:return $.extend({},t,{target:e.payload.entityID,startPos:{x:e.payload.cursorX,y:e.payload.cursorY},currentPos:{x:e.payload.cursorX,y:e.payload.cursorY}});case f.UPDATE_EDIT:return $.extend({},t,{currentPos:{x:e.payload.cursorX,y:e.payload.cursorY}});default:return t}}function u(t,e){switch(t=t||I,e.type){case f.START_EDIT:return $.extend({},t,{hoverTarget:e.payload.entityID});case f.UPDATE_PLACEHOLDER:return $.extend({},t,{hoverTarget:e.payload});case f.END_EDIT:return $.extend({},t,{hoverTarget:null});default:return t}}function d(t,e){switch(t=t||O,e.type){case f.TRIGGER_GALLERY:return $.extend({},t,{isOpened:!t.isOpened});default:return t}}function s(t,e){switch(t=t||v,e.type){case f.SET_GALLERY_FILTER_OPTS:var r=$.grep(e.payload,function(t){return t.hasOwnProperty("categoryVal")});return r.length>0?$.extend({},t,{categoryList:$.map(r,function(t){return{text:t.categoryName||t.categoryVal,val:t.categoryVal,totalPages:t.totalPages}}),category:0,page:1}):t;case f.CHANGE_GALLERY_FILTER:var a=e.payload.category,n=e.payload.page;return $.extend({},t,{page:n,category:a});case f.REQUEST_GALLERY_IMAGE:return $.extend({},t,{isFetching:!0});case f.RECEIVE_GALLERY_IMAGE:return $.extend({},t,{isFetching:!1});default:return t}}function c(t,e){switch(t=t||h,e.type){case f.REQUEST_GALLERY_IMAGE:return $.extend({},t,{isFetching:!0,list:[]});case f.RECEIVE_GALLERY_IMAGE:return $.extend({},t,{isFetching:!1,list:e.payload});default:return t}}function E(t,e){switch(t=t||A,e.type){case f.CHANGE_GALLERY_SELECTION:return $.extend({},t,{list:e.payload});case f.REQUEST_GALLERY_IMAGE:return $.extend({},t,{list:[]});default:return t}}Object.defineProperty(e,"__esModule",{value:!0}),e.GALLERY_SELECTION_DEPOT=e.GALLERY_IMAGE_DEPOT=e.GALLERY_FILTER_DEPOT=e.GALLERY_STATUS_DEPOT=e.PLACEHOLDER_DEPOT=e.EDIT_DEPOT=e.MODE_DEPOT=e.LAYOUT_DEPOT=e.FILE_DEPOT=e.FILE_STATUS_TIMEOUT=e.FILE_STATUS_ERROR=e.FILE_STATUS_COMPLETE=e.FILE_STATUS_LOADING=void 0,e.fileDepot=n,e.layoutDepot=i,e.modeDepot=o,e.editDepot=l,e.placeholderDepot=u,e.galleryStatusDepot=d,e.galleryFilterDepot=s,e.galleryImageDepot=c,e.gallerySelectionDepot=E;var p=r(1),f=a(p),g=e.FILE_STATUS_LOADING="FILE_STATUS_LOADING",_=e.FILE_STATUS_COMPLETE="FILE_STATUS_COMPLETE",D=(e.FILE_STATUS_ERROR="FILE_STATUS_ERROR",e.FILE_STATUS_TIMEOUT="FILE_STATUS_TIMEOUT",e.FILE_DEPOT="FILE_DEPOT",e.LAYOUT_DEPOT="LAYOUT_DEPOT",e.MODE_DEPOT="MODE_DEPOT",e.EDIT_DEPOT="EDIT_DEPOT",e.PLACEHOLDER_DEPOT="PLACEHOLDER_DEPOT",e.GALLERY_STATUS_DEPOT="GALLERY_STATUS_DEPOT",e.GALLERY_FILTER_DEPOT="GALLERY_FILTER_DEPOT",e.GALLERY_IMAGE_DEPOT="GALLERY_IMAGE_DEPOT",e.GALLERY_SELECTION_DEPOT="GALLERY_SELECTION_DEPOT",{entities:{},order:[],selections:[],runningID:0}),T={thumbnailLayouts:[]},L={mode:f.DISPLAY_MODE},y={target:null,startPos:{x:0,y:0},currentPos:{x:0,y:0}},I={hoverTarget:null},O={isOpened:!1},v={page:1,categoryList:[{text:"--",val:"",totalPages:1}],category:0,isFetching:!1},h={list:[],isFetching:!1},A={list:[]}},function(t,e){"use strict";function r(t){return""}function a(t,e){return t.append(e),t}function n(t,e){var r=t.left,a=t.top,n=t.width,i=t.height,o=e.x,l=e.y,u=r,d=r+n,s=a,c=a+i;return o>u&&o<d&&l>s&&l<c}Object.defineProperty(e,"__esModule",{value:!0}),e.checkEnv=r,e.appendNode=a,e.isCollided=n},function(t,e,r){"use strict";function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function n(t,e){var r=e.limit,a=$("<div />").addClass(c).css("minHeight",e.minHeight).on("dragover",function(t){t.preventDefault(),a.addClass("drag-over")}).on("dragleave",function(t){t.preventDefault(),a.removeClass("drag-over")}).on("drop",function(n){n.preventDefault(),a.removeClass("drag-over");var i=u.curryIt(t.getState.bind(t),s.FILE_DEPOT),l=n.originalEvent.dataTransfer.files;t.dispatch(o.uploadStart(l,r,i().runningID,e.onUpload))});return a}Object.defineProperty(e,"__esModule",{value:!0}),e.gen=n;var i=r(1),o=a(i),l=r(2),u=a(l),d=r(3),s=a(d),c="RT_FILE_UPLOADER"},function(t,e,r){"use strict";function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function n(t,e){var r=$("<div />").addClass("gallery");return t.listen(u.GALLERY_STATUS_DEPOT,function(){E(t,e,r)}),t.listen(u.GALLERY_FILTER_DEPOT,function(){p(t,e,r)}),t.listen(u.GALLERY_IMAGE_DEPOT,function(){f(t,e,r)}),t.listen(u.GALLERY_SELECTION_DEPOT,function(){g(t,e,r)}),c(t,e,r)}Object.defineProperty(e,"__esModule",{value:!0}),e.gen=n;var i=r(2),o=a(i),l=r(3),u=a(l),d=r(1),s=a(d),c=function(t,e,r){var a=o.curryIt(t.getState.bind(t),u.GALLERY_STATUS_DEPOT),n=o.curryIt(t.getState.bind(t),u.GALLERY_FILTER_DEPOT),i=o.curryIt(t.getState.bind(t),u.GALLERY_IMAGE_DEPOT),l=o.curryIt(t.getState.bind(t),u.GALLERY_SELECTION_DEPOT),d=o.curryIt(t.getState.bind(t),u.FILE_DEPOT);a().isOpened&&r.addClass("is-opened");var c=$("<div />").addClass("overlay").click(function(){t.dispatch(s.triggerGallery())}),E=$("<div />").addClass("title").text("露天圖庫"),p=function(){var r=$("<div />").addClass("content"),a=$("<div />").addClass("wrap"),o=function(){for(var r=$("<div />").addClass("tool-bar"),a=$("<select />").attr("data-ref","galleryPagination"),i=1;i<=n().categoryList[n().category].totalPages;i++){var o=$("<option />").attr("value",i).text("第 "+i.toString()+" 頁");a.append(o)}a.val(n().page).change(function(r){var a=$(this);t.dispatch(s.changeGalleryFilter(n().category,Number(a.val()))),t.dispatch(s.fetchGalleryImage(n().categoryList[n().category].val,Number(a.val()),e.onFetchGallery))});for(var l=$("<select />").attr("data-ref","galleryCategory"),i=0;i<n().categoryList.length;i++){var u=n().categoryList[i],o=$("<option />").attr("value",u.val).text(u.text);l.append(o)}return l.val(n().category).change(function(r){var a=$(this);t.dispatch(s.changeGalleryFilter(Number(a.val()),1)),t.dispatch(s.fetchGalleryImage(n().categoryList[n().category].val,1,e.onFetchGallery))}),r.append(l).append(a)}(),u=function(){for(var t=$("<div />").addClass("list-view").attr("data-ref","galleryListView"),r=0;r<i().list.length;r++){var a=i().list[r].url,n=$("<div />").addClass("list-item"),o=$("<img />").attr("width",e.thumbnailWidth).attr("height",e.thumbnailHeight).attr("src",a);n.append(o),t.append(n)}return t}(),c=function(){var r=$("<div />").addClass("btn-bar"),a=$("<button />").attr("type","button").addClass("rt-button rt-button-mini rt-button-submit").text("確定新增").click(function(){var r=[],a=d().runningID,n=l().list,o=i().list;if(n.length){for(var u=0;u<n.length;u++){var c=n[u];r.push({url:o[c].url,userDefinedData:o[c].userDefinedData})}t.dispatch(s.uploadFromGalleryStart(r,e.limit,a,e.onUploadFromGallery)),t.dispatch(s.triggerGallery())}}),n=$("<a />").attr("href","#").text("取消").click(function(e){e.preventDefault(),t.dispatch(s.triggerGallery())});return r.append(a).append(n)}();return a.append(o).append(u).append(c),r.append(a)}(),f=$("<div />").addClass("dialog").append(E).append(p);return r.append(c).append(f),r},E=function(t,e,r){var a=o.curryIt(t.getState.bind(t),u.GALLERY_STATUS_DEPOT);a().isOpened?r.addClass("is-opened"):r.removeClass("is-opened")},p=function(t,e,r){var a=o.curryIt(t.getState.bind(t),u.GALLERY_FILTER_DEPOT),n=r.find("[data-ref=galleryPagination]"),i=r.find("[data-ref=galleryCategory]");n.empty();for(var l=1;l<=a().categoryList[a().category].totalPages;l++){var d=$("<option />").attr("value",l).text("第 "+l.toString()+" 頁");n.append(d)}n.val(a().page),i.empty();for(var l=0;l<a().categoryList.length;l++){var s=a().categoryList[l],d=$("<option />").attr("value",l.toString()).text(s.text);i.append(d)}i.val(a().category),a().isFetching?(n.prop("disabled",!0),i.prop("disabled",!0)):(n.prop("disabled",!1),i.prop("disabled",!1))},f=function(t,e,r){var a=o.curryIt(t.getState.bind(t),u.GALLERY_IMAGE_DEPOT),n=o.curryIt(t.getState.bind(t),u.GALLERY_SELECTION_DEPOT),i=r.find("[data-ref=galleryListView]");if(i.empty(),a().isFetching){var l=$("<i />").addClass("fa fa-circle-o-notch fa-spin fa-2x fa-fw loading-ring");i.append(l)}else for(var d=0;d<a().list.length;d++){var c=a().list[d].url,E=$("<div />").addClass("list-item").click(function(){var r=$(this),a=n().list.slice(0),i=r.index(),o=a.indexOf(i);o===-1?(a.push(i),a.length>e.limit&&(a=a.slice(a.length-e.limit))):a.splice(o,1),t.dispatch(s.changeGallerySelection(a))}),p=$("<img />").attr("width",e.thumbnailWidth).attr("height",e.thumbnailHeight).attr("src",c);E.append(p),i.append(E)}},g=function(t,e,r){var a=o.curryIt(t.getState.bind(t),u.GALLERY_SELECTION_DEPOT),n=r.find("[data-ref=galleryListView]");n.find(".is-selected").removeClass("is-selected");for(var i=0;i<a().list.length;i++){var l=a().list[i];n.children().eq(l).addClass("is-selected")}}},function(t,e,r){"use strict";function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function n(t,e){var r=$("<div />"),a=o.curryIt(u,t),n=o.curryIt(c,r,l),i=o.curryIt(s,r),p=o.curryIt(E,r,l);return r.state=t({},{}),r.state.__DEBUG__={action:{},diff:[]},r.getState=i,r.listen=p,r.dispatch=function(t){if("function"==typeof t)t(r.dispatch);else{var i=a(r.state,t),o=d(r.state,i);if(e){for(var l={},u=0;u<o.length;u++)l[o[u]]=i[o[u]];console.log("\n===Action fired==="),console.log("-> Action:"),console.log(t),console.log("-> Changed parts: "),console.log(l),console.log("===================\n")}o.length&&(r.state=i,n(o))}},r}Object.defineProperty(e,"__esModule",{value:!0}),e.createStore=n;var i=r(2),o=a(i),l="RT_FILE_UPLOADER",u=function(t,e,r){return t(e,r)},d=function(t,e){var r=[];for(var a in e)e[a]!==t[a]&&r.push(a);return r},s=function(t,e){return e?t.state[e]:t.state},c=function(t,e,r){for(var a=e.toString()||"",n=0;n<r.length;n++)t.trigger(a+r[n])},E=function(t,e,r,a){var n=e.toString()||"";t.on(n+r,a)}},function(t,e,r){"use strict";function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function n(t,e){var r=(o.curryIt(t.getState.bind(t),E.MODE_DEPOT),o.curryIt(t.getState.bind(t),E.EDIT_DEPOT),o.curryIt(t.getState.bind(t),E.PLACEHOLDER_DEPOT),$("<div />").addClass("thumbnail-viewer"));return t.listen(E.FILE_DEPOT,function(){p(t,e,r)}),t.listen(E.MODE_DEPOT,function(){f(t,e,r)}),t.listen(E.EDIT_DEPOT,function(){g(t,e,r)}),t.listen(E.PLACEHOLDER_DEPOT,function(){_(t,e,r)}),p(t,e,r)}Object.defineProperty(e,"__esModule",{value:!0}),e.gen=n;var i=r(2),o=a(i),l=r(4),u=a(l),d=r(1),s=a(d),c=r(3),E=a(c),p=function(t,e,r){var a=e.thumbnailWidth,n=e.thumbnailHeight,i=o.curryIt(t.getState.bind(t),E.FILE_DEPOT),l=o.curryIt(t.getState.bind(t),E.MODE_DEPOT);r.empty();var u=$.map(i().order,function(e,o){var u=i().entities[e],d=(new FileReader,$("<div />").attr("data-ref","thumbnail").addClass("thumbnail").attr("data-key",o).css("width",a).css("height",n).on("touchstart mousedown",function(a){if(a.preventDefault(),l().mode===s.DISPLAY_MODE){var n=r.offset(),i=($(this).offset(),a.originalEvent.targetTouches),o=i?i[0].pageX:a.pageX,u=i?i[0].pageY:a.pageY;t.dispatch(s.startEdit({entityID:e,cursorX:o-n.left,cursorY:u-n.top}))}})),c=$("<div />").addClass("img");switch(u.status){case E.FILE_STATUS_LOADING:var p=$("<i />").addClass("fa fa-circle-o-notch fa-spin fa-2x fa-fw loading-ring");c.append(p);break;case E.FILE_STATUS_COMPLETE:c.css("background-image","url("+u.url+")");break;case E.FILE_STATUS_ERROR:$msg=$("<div />").addClass("msg").append($("<i />").addClass("fa fa-exclamation-triangle icon")).append($("<div />").addClass("text").text(u.errMsg)),c.append($msg)}var f=$("<div />").addClass("img-wrap").css("width",a).css("height",n).append(c),g=$("<i />").addClass("fa").addClass("fa-times").addClass("delete").on("touchstart mousedown",function(t){t.stopPropagation()}).click(function(r){r.stopPropagation(),t.dispatch(s.deleteFile(e))});return d.append(f).append(g),d});$.each(u,function(t,e){r.append(e)});var d=$.map(u,function(t){return t.position()});return t.dispatch(s.updateLayout(d)),r},f=function(t,e,r){var a=e.thumbnailWidth,n=e.thumbnailHeight,i=o.curryIt(t.getState.bind(t),E.MODE_DEPOT),l=o.curryIt(t.getState.bind(t),E.LAYOUT_DEPOT),d=o.curryIt(t.getState.bind(t),E.EDIT_DEPOT),c=o.curryIt(t.getState.bind(t),E.FILE_DEPOT),p=o.curryIt(t.getState.bind(t),E.PLACEHOLDER_DEPOT);i().mode===s.EDIT_MODE?r.on("touchend mouseup",function(e){i().mode===s.EDIT_MODE&&t.dispatch(s.endEdit(d().target,p().hoverTarget))}).on("touchmove mousemove",function(e){e.preventDefault();var r=$(this).offset(),i=e.originalEvent.targetTouches,o=i?i[0].pageX:e.pageX,E=i?i[0].pageY:e.pageY,p=o-r.left,f=E-r.top;t.dispatch(s.updateEdit({entityID:d().target,cursorX:p,cursorY:f})),$.each(l().thumbnailLayouts,function(e,r){var i={left:r.left,top:r.top,width:a,height:n},o={x:p,y:f};if(u.isCollided(i,o))return t.dispatch(s.updatePlaceholder(c().order[e])),!1})}):r.off("touchmove").off("mousemove").off("touchend").off("mouseup")},g=function(t,e,r){var a=o.curryIt(t.getState.bind(t),E.MODE_DEPOT),n=o.curryIt(t.getState.bind(t),E.EDIT_DEPOT),i=o.curryIt(t.getState.bind(t),E.FILE_DEPOT),l=o.curryIt(t.getState.bind(t),E.LAYOUT_DEPOT);return a().mode===s.EDIT_MODE&&$.each(i().order,function(t,e){e===n().target&&r.children("[data-ref=thumbnail]").eq(t).attr("date-ref","dragTarget").addClass("drag-target").css({position:"absolute",zIndex:"99",left:l().thumbnailLayouts[t].left+n().currentPos.x-n().startPos.x,top:l().thumbnailLayouts[t].top+n().currentPos.y-n().startPos.y-7})}),r},_=function(t,e,r){var a=e.thumbnailWidth,n=e.thumbnailHeight,i=o.curryIt(t.getState.bind(t),E.FILE_DEPOT),l=o.curryIt(t.getState.bind(t),E.EDIT_DEPOT),u=o.curryIt(t.getState.bind(t),E.PLACEHOLDER_DEPOT),d=u().hoverTarget,s=l().target;if(r.children("[data-ref=placeholder]").remove(),null!==d){var c=i().order.indexOf(d),p=i().order.indexOf(s),f=r.children("[data-ref=thumbnail]").eq(c),g=$("<div />").attr("data-ref","placeholder").addClass("placeholder").css({width:a,height:n});p>c?g.insertBefore(f):g.insertAfter(f)}return r}},function(t,e,r){"use strict";function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function n(t,e){var r=o.curryIt(t.getState.bind(t),s.GALLERY_FILTER_DEPOT),a=e.limit,n=$("<div />").addClass("hint-text").append($("<span />").text("選擇檔案")),i=$("<div />").addClass("hint-text").append($("<span />").addClass("separator").text("或")).append($("<span />").text("拖曳檔案至此")),l=$("<i />").addClass("upload-icon").addClass("fa").addClass("fa-upload"),d=$('<input type="file" accept="image/*;capture=camera"/>').addClass("add-local-input").attr("multiple","").change(function(r){var n=o.curryIt(t.getState.bind(t),s.FILE_DEPOT),i=$(this),l=i[0].files;t.dispatch(u.uploadStart(l,a,n().runningID,e.onUpload)),i.val("")}),E=$("<div />").addClass("rt-button").addClass("rt-button-mini").addClass("rt-button-default").text("本地檔案"),p=$("<label />").addClass("action").append(d).append(E),f=$("<button />").attr("type","button").addClass("action").addClass("rt-button").addClass("rt-button-mini").addClass("rt-button-default").text("露天圖庫").click(function(){t.dispatch(u.triggerGallery()),t.dispatch(u.fetchGalleryImage(r().categoryList[r().category].val,r().page,e.onFetchGallery))}),g=$("<div />").addClass("wrap").append(l).append(n).append(p).append(f).append(i),_=$("<div />").addClass("tool-bar").append(g);return t.listen(s.FILE_DEPOT,function(){c(t,e,_)}),c(t,e,_)}Object.defineProperty(e,"__esModule",{value:!0}),e.gen=n;var i=r(2),o=a(i),l=r(1),u=a(l),d=r(3),s=a(d),c=function(t,e,r){var a=(e.limit,o.curryIt(t.getState.bind(t),s.FILE_DEPOT));return a().order.length?r.removeClass("hint").css("height","auto"):r.addClass("hint"),r}},function(t,e,r){"use strict";function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}var n=r(2),i=a(n),o=r(7),l=a(o),u=r(4),d=a(u),s=r(3),c=a(s),E=r(1),p=a(E),f=r(5),g=a(f),_=r(9),D=a(_),T=r(8),L=a(T),y=r(6),I=a(y);window.RT=window.RT||{};var O=RT.FileUploader={},v=function(t){var e=navigator.userAgent||navigator.vendor||window.opera;return $.extend({},t,{uiType:d.checkEnv(e),minHeight:t.minHeight||160,thumbnailWidth:t.thumbnailWidth||120,thumbnailHeight:t.thumbnailHeight||90,limit:t.limit||3,galleryFilterOpts:t.galleryFilterOpts instanceof Array?t.galleryFilterOpts:[]})},h=function(t){var e=function(t,e){var r={};return r[c.FILE_DEPOT]=c.fileDepot(t[c.FILE_DEPOT],e),r[c.LAYOUT_DEPOT]=c.layoutDepot(t[c.LAYOUT_DEPOT],e),r[c.MODE_DEPOT]=c.modeDepot(t[c.MODE_DEPOT],e),r[c.EDIT_DEPOT]=c.editDepot(t[c.EDIT_DEPOT],e),r[c.PLACEHOLDER_DEPOT]=c.placeholderDepot(t[c.PLACEHOLDER_DEPOT],e),r[c.GALLERY_STATUS_DEPOT]=c.galleryStatusDepot(t[c.GALLERY_STATUS_DEPOT],e),r[c.GALLERY_FILTER_DEPOT]=c.galleryFilterDepot(t[c.GALLERY_FILTER_DEPOT],e),r[c.GALLERY_IMAGE_DEPOT]=c.galleryImageDepot(t[c.GALLERY_IMAGE_DEPOT],e),r[c.GALLERY_SELECTION_DEPOT]=c.gallerySelectionDepot(t[c.GALLERY_SELECTION_DEPOT],e),r};return l.createStore(e,t.debug)},A=function(t,e){var r=g.gen(t,e),a=D.gen(t,e),n=L.gen(t,e),o=I.gen(t,e),l=i.curryIt(d.appendNode,r);return l(a),l(n),l(o),r};O.gen=function(t,e){e=v(e);var r=i.curryIt(d.appendNode,t),a=h(e);a.dispatch(p.setGalleryFilterOpts(e.galleryFilterOpts));var n=A(a,e);return r(n),{getFiles:function(){var t=i.curryIt(a.getState.bind(a),c.FILE_DEPOT);return $.map(t().order,function(e){var r=t().entities[e];return{id:e,url:r.url,status:r.status,progress:r.progress,errMsg:r.errMsg,userDefinedData:r.userDefinedData}})},setFiles:function(t){var r=i.curryIt(a.getState.bind(a),c.FILE_DEPOT);a.dispatch(p.addFile($.map(t,function(t){return{url:t.url,userDefinedData:t.userDefinedData}}),e.limit,r().runningID))}}},O.FILE_STATUS={COMPLETE:c.FILE_STATUS_COMPLETE,LOADING:c.FILE_STATUS_LOADING,ERROR:c.FILE_STATUS_ERROR,TIMEOUT:c.FILE_STATUS_TIMEOUT}}]);